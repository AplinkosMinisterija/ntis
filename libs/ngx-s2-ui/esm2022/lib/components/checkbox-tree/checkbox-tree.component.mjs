import { Component, ContentChildren, Input, ViewEncapsulation, } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule, NG_VALUE_ACCESSOR } from '@angular/forms';
import { Subject, takeUntil } from 'rxjs';
import { IconComponent } from '../icon/icon.component';
import { TemplateDirective } from '../../directives/template.directive';
import * as i0 from "@angular/core";
import * as i1 from "../../services/s2-ui-translations.service";
import * as i2 from "@angular/common";
import * as i3 from "@angular/forms";
class CheckboxTreeComponent {
    translationsService;
    static S2_TEMPLATE_ITEM_LABEL = 'item-label';
    static getValues(items, valueProperty, state = 'checked') {
        return items.reduce((accumulator, item) => {
            if (item.children?.length) {
                accumulator.push(...CheckboxTreeComponent.getValues(item.children, valueProperty, state));
            }
            else if (state === 'any' ||
                (state === 'checked' && item.checked === true) ||
                (state === 'uncheked' && !item.checked)) {
                accumulator.push(valueProperty ? item[valueProperty] : item);
            }
            return accumulator;
        }, []);
    }
    destroy$ = new Subject();
    templatesQueryList;
    itemLabelTemplate;
    items;
    showSelectAll = true;
    selectAllText;
    inputsIdPrefix = '';
    valueProperty;
    selectAllChecked = false;
    disabled = false;
    touched = false;
    onChange;
    onTouched;
    constructor(translationsService) {
        this.translationsService = translationsService;
    }
    ngOnChanges(changes) {
        if (changes.items.currentValue) {
            this.refreshCheckedValues();
        }
    }
    ngAfterContentInit() {
        this.updateTemplates();
        this.templatesQueryList.changes.pipe(takeUntil(this.destroy$)).subscribe(() => {
            this.updateTemplates();
        });
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.unsubscribe();
    }
    writeValue(newValue) {
        if (this.onChange) {
            const setValue = (items, value) => {
                items.forEach((item) => {
                    if (item.children?.length) {
                        setValue(item.children, value);
                    }
                    else {
                        item.checked = value?.length
                            ? this.valueProperty
                                ? value.some((valueItem) => valueItem === item[this.valueProperty])
                                : value.includes(item)
                            : false;
                    }
                });
            };
            setValue(this.items, newValue);
            this.refreshCheckedValues();
        }
    }
    registerOnChange(fn) {
        this.onChange = fn;
    }
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    markAsTouched() {
        if (!this.touched) {
            this.onTouched?.();
            this.touched = true;
        }
    }
    handleSelectAll(event) {
        this.handleCheckboxChange({ children: this.items, checked: this.selectAllChecked }, event);
    }
    handleCheckboxChange(item, event) {
        if (item.children?.length && event) {
            const eventTarget = event.target;
            this.setChildrenCheckedValue(item, item.checked === 'semi' ? true : eventTarget.checked);
        }
        this.refreshCheckedValues();
        this.markAsTouched();
        this.onChange?.(this.getValues());
    }
    getValues(items = this.items, valueProperty = this.valueProperty, state = 'checked') {
        return CheckboxTreeComponent.getValues(items, valueProperty, state);
    }
    setChildrenCheckedValue(item, value) {
        item.children?.forEach((child) => {
            child.checked = value;
            if (child.children?.length) {
                this.setChildrenCheckedValue(child, value);
            }
        });
    }
    isItemChecked(item) {
        if (item.children?.length) {
            const selectedCount = item.children.reduce((accumulator, child) => {
                if (child.children?.length) {
                    const isChildChildrenSelected = this.isItemChecked(child);
                    child.checked = isChildChildrenSelected;
                    if (isChildChildrenSelected === true) {
                        return accumulator + 1;
                    }
                    else if (isChildChildrenSelected === 'semi') {
                        return accumulator + 0.5;
                    }
                }
                else if (child.checked === true) {
                    return accumulator + 1;
                }
                return accumulator;
            }, 0);
            if (selectedCount === item.children.length && item.children.length > 0) {
                return true;
            }
            else if (selectedCount > 0) {
                return 'semi';
            }
            return false;
        }
        else {
            return item.checked === true;
        }
    }
    refreshCheckedValues() {
        if (this.showSelectAll) {
            this.selectAllChecked = this.isItemChecked({ children: this.items });
        }
        else {
            this.items.forEach((item) => {
                item.checked = this.isItemChecked(item);
            });
        }
    }
    updateTemplates() {
        this.itemLabelTemplate = this.templatesQueryList.find((template) => template.s2Template === CheckboxTreeComponent.S2_TEMPLATE_ITEM_LABEL)?.template;
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: CheckboxTreeComponent, deps: [{ token: i1.S2UiTranslationsService }], target: i0.ɵɵFactoryTarget.Component });
    static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.0.2", type: CheckboxTreeComponent, isStandalone: true, selector: "s2-checkbox-tree", inputs: { items: "items", showSelectAll: "showSelectAll", selectAllText: "selectAllText", inputsIdPrefix: "inputsIdPrefix", valueProperty: "valueProperty" }, host: { classAttribute: "s2-checkbox-tree" }, providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                multi: true,
                useExisting: CheckboxTreeComponent,
            },
        ], queries: [{ propertyName: "templatesQueryList", predicate: TemplateDirective }], usesOnChanges: true, ngImport: i0, template: "<div *ngIf=\"showSelectAll\" class=\"s2-ui-inline-input-label s2-checkbox-tree-item s2-checkbox-tree-item--select-all\">\r\n  <input\r\n    type=\"checkbox\"\r\n    id=\"select-all\"\r\n    [checked]=\"selectAllChecked\"\r\n    class=\"s2-ui-input-checkbox\"\r\n    [ngClass]=\"{'s2-ui-input-checkbox--semi-selected': selectAllChecked === 'semi'}\"\r\n    (change)=\"handleSelectAll($event)\"\r\n  />\r\n  <label class=\"s2-checkbox-tree-item__label\" for=\"select-all\">\r\n    {{ selectAllText || translationsService.translations.action.selectAll }}\r\n  </label>\r\n</div>\r\n\r\n<ul class=\"s2-checkbox-tree-items\">\r\n  <ng-container *ngTemplateOutlet=\"loop; context: {items: items, idPrefix: inputsIdPrefix}\"></ng-container>\r\n</ul>\r\n\r\n<ng-template #loop let-items=\"items\" let-idPrefix=\"idPrefix\">\r\n  <ng-container *ngFor=\"let item of items; index as i\">\r\n    <li *ngIf=\"!item.hidden\">\r\n      <ng-container\r\n        *ngTemplateOutlet=\"item.children?.length ? groupView : checkboxView; context: {item: item, idPrefix: ''+idPrefix+i}\"\r\n      ></ng-container>\r\n    </li>\r\n  </ng-container>\r\n</ng-template>\r\n\r\n<ng-template #groupView let-group=\"item\" let-idPrefix=\"idPrefix\">\r\n  <div class=\"s2-ui-inline-input-label\">\r\n    <div class=\"s2-checkbox-tree-item__button-placeholder\">\r\n      <button type=\"button\" class=\"s2-checkbox-tree-item__chevron-button\" (click)=\"group.open = !group.open\">\r\n        <s2-icon>{{ group.open ? 'expand_more' : 'chevron_right'}} </s2-icon>\r\n      </button>\r\n    </div>\r\n    <input\r\n      type=\"checkbox\"\r\n      [id]=\"idPrefix + '-' + (group.key !== undefined ? group.key : group.label)\"\r\n      class=\"s2-ui-input-checkbox\"\r\n      [checked]=\"group.checked\"\r\n      [disabled]=\"disabled || group.disabled\"\r\n      [ngClass]=\"{'s2-ui-input-checkbox--semi-selected': group.checked === 'semi'}\"\r\n      (change)=\"handleCheckboxChange(group, $event)\"\r\n    />\r\n    <label\r\n      class=\"s2-checkbox-tree-item__label\"\r\n      [for]=\"idPrefix + '-' + (group.key !== undefined ? group.key : group.label)\"\r\n    >\r\n      <ng-container *ngIf=\"itemLabelTemplate\">\r\n        <ng-container *ngTemplateOutlet=\"itemLabelTemplate; context: {$implicit: group}\"></ng-container>\r\n      </ng-container>\r\n      <ng-container *ngIf=\"!itemLabelTemplate\">\r\n        {{ group.label }}\r\n      </ng-container>\r\n    </label>\r\n  </div>\r\n  <ul *ngIf=\"group.open\">\r\n    <ng-container *ngTemplateOutlet=\"loop; context: {items: group.children, idPrefix: idPrefix}\"></ng-container>\r\n  </ul>\r\n</ng-template>\r\n\r\n<ng-template #checkboxView let-checkbox=\"item\" let-idPrefix=\"idPrefix\">\r\n  <div class=\"s2-ui-inline-input-label\">\r\n    <div class=\"s2-checkbox-tree-item__button-placeholder\"></div>\r\n    <input\r\n      type=\"checkbox\"\r\n      [id]=\"idPrefix + '-' + (checkbox.key !== undefined ? checkbox.key : checkbox.label)\"\r\n      class=\"s2-ui-input-checkbox\"\r\n      [disabled]=\"disabled || checkbox.disabled\"\r\n      [(ngModel)]=\"checkbox.checked\"\r\n      (ngModelChange)=\"handleCheckboxChange(checkbox, null)\"\r\n    />\r\n    <label\r\n      class=\"s2-checkbox-tree-item__label\"\r\n      [for]=\"idPrefix + '-' + (checkbox.key !== undefined ? checkbox.key : checkbox.label)\"\r\n    >\r\n      <ng-container *ngIf=\"itemLabelTemplate\">\r\n        <ng-container *ngTemplateOutlet=\"itemLabelTemplate; context: {$implicit: checkbox}\"></ng-container>\r\n      </ng-container>\r\n      <ng-container *ngIf=\"!itemLabelTemplate\">\r\n        {{ checkbox.label }}\r\n      </ng-container>\r\n    </label>\r\n  </div>\r\n</ng-template>\r\n", styles: [".s2-checkbox-tree{display:block}.s2-checkbox-tree-items li{margin-top:.125rem;margin-bottom:.125rem}.s2-checkbox-tree-items li li{margin-left:1.5rem}.s2-checkbox-tree-item__button-placeholder{min-width:1.25rem}.s2-checkbox-tree-item__chevron-button{display:flex;align-items:center;justify-content:center;font-size:var(--s2-font-size-xl);line-height:var(--s2-font-size-xl-line-height)}.s2-checkbox-tree-item__label{padding-top:1px;font-size:var(--s2-font-size-sm);line-height:var(--s2-font-size-sm-line-height)}.s2-checkbox-tree-item--select-all{padding-bottom:.125rem}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i2.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i2.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i3.CheckboxControlValueAccessor, selector: "input[type=checkbox][formControlName],input[type=checkbox][formControl],input[type=checkbox][ngModel]" }, { kind: "directive", type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i3.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "component", type: IconComponent, selector: "s2-icon" }], encapsulation: i0.ViewEncapsulation.None });
}
export { CheckboxTreeComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: CheckboxTreeComponent, decorators: [{
            type: Component,
            args: [{ selector: 's2-checkbox-tree', standalone: true, imports: [CommonModule, FormsModule, IconComponent], encapsulation: ViewEncapsulation.None, host: { class: 's2-checkbox-tree' }, providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            multi: true,
                            useExisting: CheckboxTreeComponent,
                        },
                    ], template: "<div *ngIf=\"showSelectAll\" class=\"s2-ui-inline-input-label s2-checkbox-tree-item s2-checkbox-tree-item--select-all\">\r\n  <input\r\n    type=\"checkbox\"\r\n    id=\"select-all\"\r\n    [checked]=\"selectAllChecked\"\r\n    class=\"s2-ui-input-checkbox\"\r\n    [ngClass]=\"{'s2-ui-input-checkbox--semi-selected': selectAllChecked === 'semi'}\"\r\n    (change)=\"handleSelectAll($event)\"\r\n  />\r\n  <label class=\"s2-checkbox-tree-item__label\" for=\"select-all\">\r\n    {{ selectAllText || translationsService.translations.action.selectAll }}\r\n  </label>\r\n</div>\r\n\r\n<ul class=\"s2-checkbox-tree-items\">\r\n  <ng-container *ngTemplateOutlet=\"loop; context: {items: items, idPrefix: inputsIdPrefix}\"></ng-container>\r\n</ul>\r\n\r\n<ng-template #loop let-items=\"items\" let-idPrefix=\"idPrefix\">\r\n  <ng-container *ngFor=\"let item of items; index as i\">\r\n    <li *ngIf=\"!item.hidden\">\r\n      <ng-container\r\n        *ngTemplateOutlet=\"item.children?.length ? groupView : checkboxView; context: {item: item, idPrefix: ''+idPrefix+i}\"\r\n      ></ng-container>\r\n    </li>\r\n  </ng-container>\r\n</ng-template>\r\n\r\n<ng-template #groupView let-group=\"item\" let-idPrefix=\"idPrefix\">\r\n  <div class=\"s2-ui-inline-input-label\">\r\n    <div class=\"s2-checkbox-tree-item__button-placeholder\">\r\n      <button type=\"button\" class=\"s2-checkbox-tree-item__chevron-button\" (click)=\"group.open = !group.open\">\r\n        <s2-icon>{{ group.open ? 'expand_more' : 'chevron_right'}} </s2-icon>\r\n      </button>\r\n    </div>\r\n    <input\r\n      type=\"checkbox\"\r\n      [id]=\"idPrefix + '-' + (group.key !== undefined ? group.key : group.label)\"\r\n      class=\"s2-ui-input-checkbox\"\r\n      [checked]=\"group.checked\"\r\n      [disabled]=\"disabled || group.disabled\"\r\n      [ngClass]=\"{'s2-ui-input-checkbox--semi-selected': group.checked === 'semi'}\"\r\n      (change)=\"handleCheckboxChange(group, $event)\"\r\n    />\r\n    <label\r\n      class=\"s2-checkbox-tree-item__label\"\r\n      [for]=\"idPrefix + '-' + (group.key !== undefined ? group.key : group.label)\"\r\n    >\r\n      <ng-container *ngIf=\"itemLabelTemplate\">\r\n        <ng-container *ngTemplateOutlet=\"itemLabelTemplate; context: {$implicit: group}\"></ng-container>\r\n      </ng-container>\r\n      <ng-container *ngIf=\"!itemLabelTemplate\">\r\n        {{ group.label }}\r\n      </ng-container>\r\n    </label>\r\n  </div>\r\n  <ul *ngIf=\"group.open\">\r\n    <ng-container *ngTemplateOutlet=\"loop; context: {items: group.children, idPrefix: idPrefix}\"></ng-container>\r\n  </ul>\r\n</ng-template>\r\n\r\n<ng-template #checkboxView let-checkbox=\"item\" let-idPrefix=\"idPrefix\">\r\n  <div class=\"s2-ui-inline-input-label\">\r\n    <div class=\"s2-checkbox-tree-item__button-placeholder\"></div>\r\n    <input\r\n      type=\"checkbox\"\r\n      [id]=\"idPrefix + '-' + (checkbox.key !== undefined ? checkbox.key : checkbox.label)\"\r\n      class=\"s2-ui-input-checkbox\"\r\n      [disabled]=\"disabled || checkbox.disabled\"\r\n      [(ngModel)]=\"checkbox.checked\"\r\n      (ngModelChange)=\"handleCheckboxChange(checkbox, null)\"\r\n    />\r\n    <label\r\n      class=\"s2-checkbox-tree-item__label\"\r\n      [for]=\"idPrefix + '-' + (checkbox.key !== undefined ? checkbox.key : checkbox.label)\"\r\n    >\r\n      <ng-container *ngIf=\"itemLabelTemplate\">\r\n        <ng-container *ngTemplateOutlet=\"itemLabelTemplate; context: {$implicit: checkbox}\"></ng-container>\r\n      </ng-container>\r\n      <ng-container *ngIf=\"!itemLabelTemplate\">\r\n        {{ checkbox.label }}\r\n      </ng-container>\r\n    </label>\r\n  </div>\r\n</ng-template>\r\n", styles: [".s2-checkbox-tree{display:block}.s2-checkbox-tree-items li{margin-top:.125rem;margin-bottom:.125rem}.s2-checkbox-tree-items li li{margin-left:1.5rem}.s2-checkbox-tree-item__button-placeholder{min-width:1.25rem}.s2-checkbox-tree-item__chevron-button{display:flex;align-items:center;justify-content:center;font-size:var(--s2-font-size-xl);line-height:var(--s2-font-size-xl-line-height)}.s2-checkbox-tree-item__label{padding-top:1px;font-size:var(--s2-font-size-sm);line-height:var(--s2-font-size-sm-line-height)}.s2-checkbox-tree-item--select-all{padding-bottom:.125rem}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.S2UiTranslationsService }]; }, propDecorators: { templatesQueryList: [{
                type: ContentChildren,
                args: [TemplateDirective]
            }], items: [{
                type: Input
            }], showSelectAll: [{
                type: Input
            }], selectAllText: [{
                type: Input
            }], inputsIdPrefix: [{
                type: Input
            }], valueProperty: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tib3gtdHJlZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtczItdWkvc3JjL2xpYi9jb21wb25lbnRzL2NoZWNrYm94LXRyZWUvY2hlY2tib3gtdHJlZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtczItdWkvc3JjL2xpYi9jb21wb25lbnRzL2NoZWNrYm94LXRyZWUvY2hlY2tib3gtdHJlZS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsU0FBUyxFQUNULGVBQWUsRUFDZixLQUFLLEVBTUwsaUJBQWlCLEdBQ2xCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQXdCLFdBQVcsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RGLE9BQU8sRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzFDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN2RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQzs7Ozs7QUFtQnhFLE1BZ0JhLHFCQUFxQjtJQXlDYjtJQXhDbkIsTUFBTSxDQUFVLHNCQUFzQixHQUFHLFlBQVksQ0FBQztJQUV0RCxNQUFNLENBQUMsU0FBUyxDQUNkLEtBQTRCLEVBQzVCLGFBQXdDLEVBQ3hDLFFBQXdDLFNBQVM7UUFFakQsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxFQUFFLElBQUksRUFBRSxFQUFFO1lBQ3hDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUU7Z0JBQ3pCLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxxQkFBcUIsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQzthQUMzRjtpQkFBTSxJQUNMLEtBQUssS0FBSyxLQUFLO2dCQUNmLENBQUMsS0FBSyxLQUFLLFNBQVMsSUFBSSxJQUFJLENBQUMsT0FBTyxLQUFLLElBQUksQ0FBQztnQkFDOUMsQ0FBQyxLQUFLLEtBQUssVUFBVSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUN2QztnQkFDQSxXQUFXLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUM5RDtZQUNELE9BQU8sV0FBVyxDQUFDO1FBQ3JCLENBQUMsRUFBRSxFQUFlLENBQUMsQ0FBQztJQUN0QixDQUFDO0lBRVEsUUFBUSxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7SUFHeEMsa0JBQWtCLENBQStCO0lBQ2pELGlCQUFpQixDQUF1QjtJQUUvQixLQUFLLENBQXFCO0lBQzFCLGFBQWEsR0FBWSxJQUFJLENBQUM7SUFDOUIsYUFBYSxDQUFTO0lBQ3RCLGNBQWMsR0FBRyxFQUFFLENBQUM7SUFDcEIsYUFBYSxDQUF5QjtJQUUvQyxnQkFBZ0IsR0FBNEIsS0FBSyxDQUFDO0lBRWxELFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDakIsT0FBTyxHQUFHLEtBQUssQ0FBQztJQUNoQixRQUFRLENBQWtEO0lBQzFELFNBQVMsQ0FBYTtJQUV0QixZQUFtQixtQkFBNEM7UUFBNUMsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUF5QjtJQUFHLENBQUM7SUFFbkUsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUU7WUFDOUIsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7U0FDN0I7SUFDSCxDQUFDO0lBRUQsa0JBQWtCO1FBQ2hCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRTtZQUM1RSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDekIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUM5QixDQUFDO0lBRUQsVUFBVSxDQUFDLFFBQW1CO1FBQzVCLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixNQUFNLFFBQVEsR0FBRyxDQUFDLEtBQXlCLEVBQUUsS0FBZ0IsRUFBUSxFQUFFO2dCQUNyRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7b0JBQ3JCLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUU7d0JBQ3pCLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO3FCQUNoQzt5QkFBTTt3QkFDTCxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssRUFBRSxNQUFNOzRCQUMxQixDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWE7Z0NBQ2xCLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxTQUFTLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztnQ0FDbkUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDOzRCQUN4QixDQUFDLENBQUMsS0FBSyxDQUFDO3FCQUNYO2dCQUNILENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDO1lBQ0YsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDL0IsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7U0FDN0I7SUFDSCxDQUFDO0lBRUQsZ0JBQWdCLENBQUMsRUFBbUQ7UUFDbEUsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUVELGlCQUFpQixDQUFDLEVBQWM7UUFDOUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7SUFDdEIsQ0FBQztJQUVELGdCQUFnQixDQUFDLFVBQW1CO1FBQ2xDLElBQUksQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDO0lBQzdCLENBQUM7SUFFRCxhQUFhO1FBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDakIsSUFBSSxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUM7WUFDbkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7U0FDckI7SUFDSCxDQUFDO0lBRUQsZUFBZSxDQUFDLEtBQVk7UUFDMUIsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsRUFBc0IsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNqSCxDQUFDO0lBRUQsb0JBQW9CLENBQUMsSUFBc0IsRUFBRSxLQUFZO1FBQ3ZELElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxNQUFNLElBQUksS0FBSyxFQUFFO1lBQ2xDLE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxNQUEwQixDQUFDO1lBQ3JELElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE9BQU8sS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQzFGO1FBQ0QsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7UUFDNUIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRU8sU0FBUyxDQUNmLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxFQUNsQixhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFDbEMsUUFBd0MsU0FBUztRQUVqRCxPQUFPLHFCQUFxQixDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsYUFBYSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3RFLENBQUM7SUFFTyx1QkFBdUIsQ0FBQyxJQUFzQixFQUFFLEtBQWM7UUFDcEUsSUFBSSxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUMvQixLQUFLLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztZQUN0QixJQUFJLEtBQUssQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFO2dCQUMxQixJQUFJLENBQUMsdUJBQXVCLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQzVDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU8sYUFBYSxDQUFDLElBQXNCO1FBQzFDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUU7WUFDekIsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLEVBQUUsS0FBSyxFQUFFLEVBQUU7Z0JBQ2hFLElBQUksS0FBSyxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUU7b0JBQzFCLE1BQU0sdUJBQXVCLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDMUQsS0FBSyxDQUFDLE9BQU8sR0FBRyx1QkFBdUIsQ0FBQztvQkFDeEMsSUFBSSx1QkFBdUIsS0FBSyxJQUFJLEVBQUU7d0JBQ3BDLE9BQU8sV0FBVyxHQUFHLENBQUMsQ0FBQztxQkFDeEI7eUJBQU0sSUFBSSx1QkFBdUIsS0FBSyxNQUFNLEVBQUU7d0JBQzdDLE9BQU8sV0FBVyxHQUFHLEdBQUcsQ0FBQztxQkFDMUI7aUJBQ0Y7cUJBQU0sSUFBSSxLQUFLLENBQUMsT0FBTyxLQUFLLElBQUksRUFBRTtvQkFDakMsT0FBTyxXQUFXLEdBQUcsQ0FBQyxDQUFDO2lCQUN4QjtnQkFDRCxPQUFPLFdBQVcsQ0FBQztZQUNyQixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDTixJQUFJLGFBQWEsS0FBSyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQ3RFLE9BQU8sSUFBSSxDQUFDO2FBQ2I7aUJBQU0sSUFBSSxhQUFhLEdBQUcsQ0FBQyxFQUFFO2dCQUM1QixPQUFPLE1BQU0sQ0FBQzthQUNmO1lBQ0QsT0FBTyxLQUFLLENBQUM7U0FDZDthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUMsT0FBTyxLQUFLLElBQUksQ0FBQztTQUM5QjtJQUNILENBQUM7SUFFTyxvQkFBb0I7UUFDMUIsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQXNCLENBQUMsQ0FBQztTQUMxRjthQUFNO1lBQ0wsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtnQkFDMUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUMsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDO0lBRU8sZUFBZTtRQUNyQixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FDbkQsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEtBQUsscUJBQXFCLENBQUMsc0JBQXNCLENBQ25GLEVBQUUsUUFBUSxDQUFDO0lBQ2QsQ0FBQzt1R0E1S1UscUJBQXFCOzJGQUFyQixxQkFBcUIsMlFBUnJCO1lBQ1Q7Z0JBQ0UsT0FBTyxFQUFFLGlCQUFpQjtnQkFDMUIsS0FBSyxFQUFFLElBQUk7Z0JBQ1gsV0FBVyxFQUFFLHFCQUFxQjthQUNuQztTQUNGLDZEQTBCZ0IsaUJBQWlCLGtEQzNFcEMsd25IQXFGQSxtbkJEL0NZLFlBQVksb2dCQUFFLFdBQVcsZ2hCQUFFLGFBQWE7O1NBYXZDLHFCQUFxQjsyRkFBckIscUJBQXFCO2tCQWhCakMsU0FBUzsrQkFDRSxrQkFBa0IsY0FDaEIsSUFBSSxXQUNQLENBQUMsWUFBWSxFQUFFLFdBQVcsRUFBRSxhQUFhLENBQUMsaUJBR3BDLGlCQUFpQixDQUFDLElBQUksUUFDL0IsRUFBRSxLQUFLLEVBQUUsa0JBQWtCLEVBQUUsYUFDeEI7d0JBQ1Q7NEJBQ0UsT0FBTyxFQUFFLGlCQUFpQjs0QkFDMUIsS0FBSyxFQUFFLElBQUk7NEJBQ1gsV0FBVyx1QkFBdUI7eUJBQ25DO3FCQUNGOzhHQTJCRCxrQkFBa0I7c0JBRGpCLGVBQWU7dUJBQUMsaUJBQWlCO2dCQUl6QixLQUFLO3NCQUFiLEtBQUs7Z0JBQ0csYUFBYTtzQkFBckIsS0FBSztnQkFDRyxhQUFhO3NCQUFyQixLQUFLO2dCQUNHLGNBQWM7c0JBQXRCLEtBQUs7Z0JBQ0csYUFBYTtzQkFBckIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQWZ0ZXJDb250ZW50SW5pdCxcclxuICBDb21wb25lbnQsXHJcbiAgQ29udGVudENoaWxkcmVuLFxyXG4gIElucHV0LFxyXG4gIE9uQ2hhbmdlcyxcclxuICBPbkRlc3Ryb3ksXHJcbiAgUXVlcnlMaXN0LFxyXG4gIFNpbXBsZUNoYW5nZXMsXHJcbiAgVGVtcGxhdGVSZWYsXHJcbiAgVmlld0VuY2Fwc3VsYXRpb24sXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBGb3Jtc01vZHVsZSwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IFN1YmplY3QsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBJY29uQ29tcG9uZW50IH0gZnJvbSAnLi4vaWNvbi9pY29uLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFRlbXBsYXRlRGlyZWN0aXZlIH0gZnJvbSAnLi4vLi4vZGlyZWN0aXZlcy90ZW1wbGF0ZS5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBTMlVpVHJhbnNsYXRpb25zU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3MyLXVpLXRyYW5zbGF0aW9ucy5zZXJ2aWNlJztcclxuXHJcbmV4cG9ydCB0eXBlIENoZWNrYm94VHJlZUl0ZW1DaGVja2VkID0gYm9vbGVhbiB8ICdzZW1pJztcclxuXHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbmV4cG9ydCBpbnRlcmZhY2UgQ2hlY2tib3hUcmVlSXRlbTxUID0gYW55PiB7XHJcbiAgY2hlY2tlZD86IENoZWNrYm94VHJlZUl0ZW1DaGVja2VkO1xyXG4gIGNoaWxkcmVuPzogQ2hlY2tib3hUcmVlSXRlbTxUPltdO1xyXG4gIGNsYXNzTmFtZT86IHN0cmluZztcclxuICBkaXNhYmxlZD86IGJvb2xlYW47XHJcbiAgZXh0cmFzPzogVDtcclxuICBoaWRkZW4/OiBib29sZWFuO1xyXG4gIGtleT86IHN0cmluZztcclxuICBsYWJlbDogc3RyaW5nO1xyXG4gIG9wZW4/OiBib29sZWFuO1xyXG4gIHBhcmVudD86IENoZWNrYm94VHJlZUl0ZW08VD5bXTtcclxufVxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdzMi1jaGVja2JveC10cmVlJyxcclxuICBzdGFuZGFsb25lOiB0cnVlLFxyXG4gIGltcG9ydHM6IFtDb21tb25Nb2R1bGUsIEZvcm1zTW9kdWxlLCBJY29uQ29tcG9uZW50XSxcclxuICB0ZW1wbGF0ZVVybDogJy4vY2hlY2tib3gtdHJlZS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vY2hlY2tib3gtdHJlZS5jb21wb25lbnQuc2NzcyddLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgaG9zdDogeyBjbGFzczogJ3MyLWNoZWNrYm94LXRyZWUnIH0sXHJcbiAgcHJvdmlkZXJzOiBbXHJcbiAgICB7XHJcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgICBtdWx0aTogdHJ1ZSxcclxuICAgICAgdXNlRXhpc3Rpbmc6IENoZWNrYm94VHJlZUNvbXBvbmVudCxcclxuICAgIH0sXHJcbiAgXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIENoZWNrYm94VHJlZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgQWZ0ZXJDb250ZW50SW5pdCwgT25EZXN0cm95LCBDb250cm9sVmFsdWVBY2Nlc3NvciB7XHJcbiAgc3RhdGljIHJlYWRvbmx5IFMyX1RFTVBMQVRFX0lURU1fTEFCRUwgPSAnaXRlbS1sYWJlbCc7XHJcblxyXG4gIHN0YXRpYyBnZXRWYWx1ZXM8VCA9IG5ldmVyPihcclxuICAgIGl0ZW1zOiBDaGVja2JveFRyZWVJdGVtPFQ+W10sXHJcbiAgICB2YWx1ZVByb3BlcnR5OiBrZXlvZiBDaGVja2JveFRyZWVJdGVtPFQ+LFxyXG4gICAgc3RhdGU6ICdjaGVja2VkJyB8ICd1bmNoZWtlZCcgfCAnYW55JyA9ICdjaGVja2VkJ1xyXG4gICk6IENoZWNrYm94VHJlZUl0ZW08VD5bXSB8IHVua25vd25bXSB7XHJcbiAgICByZXR1cm4gaXRlbXMucmVkdWNlKChhY2N1bXVsYXRvciwgaXRlbSkgPT4ge1xyXG4gICAgICBpZiAoaXRlbS5jaGlsZHJlbj8ubGVuZ3RoKSB7XHJcbiAgICAgICAgYWNjdW11bGF0b3IucHVzaCguLi5DaGVja2JveFRyZWVDb21wb25lbnQuZ2V0VmFsdWVzKGl0ZW0uY2hpbGRyZW4sIHZhbHVlUHJvcGVydHksIHN0YXRlKSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoXHJcbiAgICAgICAgc3RhdGUgPT09ICdhbnknIHx8XHJcbiAgICAgICAgKHN0YXRlID09PSAnY2hlY2tlZCcgJiYgaXRlbS5jaGVja2VkID09PSB0cnVlKSB8fFxyXG4gICAgICAgIChzdGF0ZSA9PT0gJ3VuY2hla2VkJyAmJiAhaXRlbS5jaGVja2VkKVxyXG4gICAgICApIHtcclxuICAgICAgICBhY2N1bXVsYXRvci5wdXNoKHZhbHVlUHJvcGVydHkgPyBpdGVtW3ZhbHVlUHJvcGVydHldIDogaXRlbSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yO1xyXG4gICAgfSwgW10gYXMgdW5rbm93bltdKTtcclxuICB9XHJcblxyXG4gIHJlYWRvbmx5IGRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcclxuXHJcbiAgQENvbnRlbnRDaGlsZHJlbihUZW1wbGF0ZURpcmVjdGl2ZSlcclxuICB0ZW1wbGF0ZXNRdWVyeUxpc3Q6IFF1ZXJ5TGlzdDxUZW1wbGF0ZURpcmVjdGl2ZT47XHJcbiAgaXRlbUxhYmVsVGVtcGxhdGU6IFRlbXBsYXRlUmVmPHVua25vd24+O1xyXG5cclxuICBASW5wdXQoKSBpdGVtczogQ2hlY2tib3hUcmVlSXRlbVtdO1xyXG4gIEBJbnB1dCgpIHNob3dTZWxlY3RBbGw6IGJvb2xlYW4gPSB0cnVlO1xyXG4gIEBJbnB1dCgpIHNlbGVjdEFsbFRleHQ6IHN0cmluZztcclxuICBASW5wdXQoKSBpbnB1dHNJZFByZWZpeCA9ICcnO1xyXG4gIEBJbnB1dCgpIHZhbHVlUHJvcGVydHk6IGtleW9mIENoZWNrYm94VHJlZUl0ZW07XHJcblxyXG4gIHNlbGVjdEFsbENoZWNrZWQ6IENoZWNrYm94VHJlZUl0ZW1DaGVja2VkID0gZmFsc2U7XHJcblxyXG4gIGRpc2FibGVkID0gZmFsc2U7XHJcbiAgdG91Y2hlZCA9IGZhbHNlO1xyXG4gIG9uQ2hhbmdlOiAodmFsdWU6IHVua25vd25bXSB8IENoZWNrYm94VHJlZUl0ZW1bXSkgPT4gdm9pZDtcclxuICBvblRvdWNoZWQ6ICgpID0+IHZvaWQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyB0cmFuc2xhdGlvbnNTZXJ2aWNlOiBTMlVpVHJhbnNsYXRpb25zU2VydmljZSkge31cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgaWYgKGNoYW5nZXMuaXRlbXMuY3VycmVudFZhbHVlKSB7XHJcbiAgICAgIHRoaXMucmVmcmVzaENoZWNrZWRWYWx1ZXMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMudXBkYXRlVGVtcGxhdGVzKCk7XHJcbiAgICB0aGlzLnRlbXBsYXRlc1F1ZXJ5TGlzdC5jaGFuZ2VzLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICB0aGlzLnVwZGF0ZVRlbXBsYXRlcygpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xyXG4gICAgdGhpcy5kZXN0cm95JC51bnN1YnNjcmliZSgpO1xyXG4gIH1cclxuXHJcbiAgd3JpdGVWYWx1ZShuZXdWYWx1ZTogdW5rbm93bltdKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5vbkNoYW5nZSkge1xyXG4gICAgICBjb25zdCBzZXRWYWx1ZSA9IChpdGVtczogQ2hlY2tib3hUcmVlSXRlbVtdLCB2YWx1ZTogdW5rbm93bltdKTogdm9pZCA9PiB7XHJcbiAgICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4/Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICBzZXRWYWx1ZShpdGVtLmNoaWxkcmVuLCB2YWx1ZSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpdGVtLmNoZWNrZWQgPSB2YWx1ZT8ubGVuZ3RoXHJcbiAgICAgICAgICAgICAgPyB0aGlzLnZhbHVlUHJvcGVydHlcclxuICAgICAgICAgICAgICAgID8gdmFsdWUuc29tZSgodmFsdWVJdGVtKSA9PiB2YWx1ZUl0ZW0gPT09IGl0ZW1bdGhpcy52YWx1ZVByb3BlcnR5XSlcclxuICAgICAgICAgICAgICAgIDogdmFsdWUuaW5jbHVkZXMoaXRlbSlcclxuICAgICAgICAgICAgICA6IGZhbHNlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG4gICAgICBzZXRWYWx1ZSh0aGlzLml0ZW1zLCBuZXdWYWx1ZSk7XHJcbiAgICAgIHRoaXMucmVmcmVzaENoZWNrZWRWYWx1ZXMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46ICh2YWx1ZTogdW5rbm93bltdIHwgQ2hlY2tib3hUcmVlSXRlbVtdKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICB0aGlzLm9uQ2hhbmdlID0gZm47XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4gdm9pZCk6IHZvaWQge1xyXG4gICAgdGhpcy5vblRvdWNoZWQgPSBmbjtcclxuICB9XHJcblxyXG4gIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XHJcbiAgfVxyXG5cclxuICBtYXJrQXNUb3VjaGVkKCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLnRvdWNoZWQpIHtcclxuICAgICAgdGhpcy5vblRvdWNoZWQ/LigpO1xyXG4gICAgICB0aGlzLnRvdWNoZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaGFuZGxlU2VsZWN0QWxsKGV2ZW50OiBFdmVudCk6IHZvaWQge1xyXG4gICAgdGhpcy5oYW5kbGVDaGVja2JveENoYW5nZSh7IGNoaWxkcmVuOiB0aGlzLml0ZW1zLCBjaGVja2VkOiB0aGlzLnNlbGVjdEFsbENoZWNrZWQgfSBhcyBDaGVja2JveFRyZWVJdGVtLCBldmVudCk7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVDaGVja2JveENoYW5nZShpdGVtOiBDaGVja2JveFRyZWVJdGVtLCBldmVudDogRXZlbnQpOiB2b2lkIHtcclxuICAgIGlmIChpdGVtLmNoaWxkcmVuPy5sZW5ndGggJiYgZXZlbnQpIHtcclxuICAgICAgY29uc3QgZXZlbnRUYXJnZXQgPSBldmVudC50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgdGhpcy5zZXRDaGlsZHJlbkNoZWNrZWRWYWx1ZShpdGVtLCBpdGVtLmNoZWNrZWQgPT09ICdzZW1pJyA/IHRydWUgOiBldmVudFRhcmdldC5jaGVja2VkKTtcclxuICAgIH1cclxuICAgIHRoaXMucmVmcmVzaENoZWNrZWRWYWx1ZXMoKTtcclxuICAgIHRoaXMubWFya0FzVG91Y2hlZCgpO1xyXG4gICAgdGhpcy5vbkNoYW5nZT8uKHRoaXMuZ2V0VmFsdWVzKCkpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRWYWx1ZXMoXHJcbiAgICBpdGVtcyA9IHRoaXMuaXRlbXMsXHJcbiAgICB2YWx1ZVByb3BlcnR5ID0gdGhpcy52YWx1ZVByb3BlcnR5LFxyXG4gICAgc3RhdGU6ICdjaGVja2VkJyB8ICd1bmNoZWtlZCcgfCAnYW55JyA9ICdjaGVja2VkJ1xyXG4gICk6IENoZWNrYm94VHJlZUl0ZW1bXSB8IHVua25vd25bXSB7XHJcbiAgICByZXR1cm4gQ2hlY2tib3hUcmVlQ29tcG9uZW50LmdldFZhbHVlcyhpdGVtcywgdmFsdWVQcm9wZXJ0eSwgc3RhdGUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRDaGlsZHJlbkNoZWNrZWRWYWx1ZShpdGVtOiBDaGVja2JveFRyZWVJdGVtLCB2YWx1ZTogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgaXRlbS5jaGlsZHJlbj8uZm9yRWFjaCgoY2hpbGQpID0+IHtcclxuICAgICAgY2hpbGQuY2hlY2tlZCA9IHZhbHVlO1xyXG4gICAgICBpZiAoY2hpbGQuY2hpbGRyZW4/Lmxlbmd0aCkge1xyXG4gICAgICAgIHRoaXMuc2V0Q2hpbGRyZW5DaGVja2VkVmFsdWUoY2hpbGQsIHZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzSXRlbUNoZWNrZWQoaXRlbTogQ2hlY2tib3hUcmVlSXRlbSk6IENoZWNrYm94VHJlZUl0ZW1DaGVja2VkIHtcclxuICAgIGlmIChpdGVtLmNoaWxkcmVuPy5sZW5ndGgpIHtcclxuICAgICAgY29uc3Qgc2VsZWN0ZWRDb3VudCA9IGl0ZW0uY2hpbGRyZW4ucmVkdWNlKChhY2N1bXVsYXRvciwgY2hpbGQpID0+IHtcclxuICAgICAgICBpZiAoY2hpbGQuY2hpbGRyZW4/Lmxlbmd0aCkge1xyXG4gICAgICAgICAgY29uc3QgaXNDaGlsZENoaWxkcmVuU2VsZWN0ZWQgPSB0aGlzLmlzSXRlbUNoZWNrZWQoY2hpbGQpO1xyXG4gICAgICAgICAgY2hpbGQuY2hlY2tlZCA9IGlzQ2hpbGRDaGlsZHJlblNlbGVjdGVkO1xyXG4gICAgICAgICAgaWYgKGlzQ2hpbGRDaGlsZHJlblNlbGVjdGVkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhY2N1bXVsYXRvciArIDE7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGlzQ2hpbGRDaGlsZHJlblNlbGVjdGVkID09PSAnc2VtaScpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yICsgMC41O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoY2hpbGQuY2hlY2tlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yICsgMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yO1xyXG4gICAgICB9LCAwKTtcclxuICAgICAgaWYgKHNlbGVjdGVkQ291bnQgPT09IGl0ZW0uY2hpbGRyZW4ubGVuZ3RoICYmIGl0ZW0uY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9IGVsc2UgaWYgKHNlbGVjdGVkQ291bnQgPiAwKSB7XHJcbiAgICAgICAgcmV0dXJuICdzZW1pJztcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gaXRlbS5jaGVja2VkID09PSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZWZyZXNoQ2hlY2tlZFZhbHVlcygpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLnNob3dTZWxlY3RBbGwpIHtcclxuICAgICAgdGhpcy5zZWxlY3RBbGxDaGVja2VkID0gdGhpcy5pc0l0ZW1DaGVja2VkKHsgY2hpbGRyZW46IHRoaXMuaXRlbXMgfSBhcyBDaGVja2JveFRyZWVJdGVtKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRoaXMuaXNJdGVtQ2hlY2tlZChpdGVtKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZVRlbXBsYXRlcygpOiB2b2lkIHtcclxuICAgIHRoaXMuaXRlbUxhYmVsVGVtcGxhdGUgPSB0aGlzLnRlbXBsYXRlc1F1ZXJ5TGlzdC5maW5kKFxyXG4gICAgICAodGVtcGxhdGUpID0+IHRlbXBsYXRlLnMyVGVtcGxhdGUgPT09IENoZWNrYm94VHJlZUNvbXBvbmVudC5TMl9URU1QTEFURV9JVEVNX0xBQkVMXHJcbiAgICApPy50ZW1wbGF0ZTtcclxuICB9XHJcbn1cclxuIiwiPGRpdiAqbmdJZj1cInNob3dTZWxlY3RBbGxcIiBjbGFzcz1cInMyLXVpLWlubGluZS1pbnB1dC1sYWJlbCBzMi1jaGVja2JveC10cmVlLWl0ZW0gczItY2hlY2tib3gtdHJlZS1pdGVtLS1zZWxlY3QtYWxsXCI+XHJcbiAgPGlucHV0XHJcbiAgICB0eXBlPVwiY2hlY2tib3hcIlxyXG4gICAgaWQ9XCJzZWxlY3QtYWxsXCJcclxuICAgIFtjaGVja2VkXT1cInNlbGVjdEFsbENoZWNrZWRcIlxyXG4gICAgY2xhc3M9XCJzMi11aS1pbnB1dC1jaGVja2JveFwiXHJcbiAgICBbbmdDbGFzc109XCJ7J3MyLXVpLWlucHV0LWNoZWNrYm94LS1zZW1pLXNlbGVjdGVkJzogc2VsZWN0QWxsQ2hlY2tlZCA9PT0gJ3NlbWknfVwiXHJcbiAgICAoY2hhbmdlKT1cImhhbmRsZVNlbGVjdEFsbCgkZXZlbnQpXCJcclxuICAvPlxyXG4gIDxsYWJlbCBjbGFzcz1cInMyLWNoZWNrYm94LXRyZWUtaXRlbV9fbGFiZWxcIiBmb3I9XCJzZWxlY3QtYWxsXCI+XHJcbiAgICB7eyBzZWxlY3RBbGxUZXh0IHx8IHRyYW5zbGF0aW9uc1NlcnZpY2UudHJhbnNsYXRpb25zLmFjdGlvbi5zZWxlY3RBbGwgfX1cclxuICA8L2xhYmVsPlxyXG48L2Rpdj5cclxuXHJcbjx1bCBjbGFzcz1cInMyLWNoZWNrYm94LXRyZWUtaXRlbXNcIj5cclxuICA8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwibG9vcDsgY29udGV4dDoge2l0ZW1zOiBpdGVtcywgaWRQcmVmaXg6IGlucHV0c0lkUHJlZml4fVwiPjwvbmctY29udGFpbmVyPlxyXG48L3VsPlxyXG5cclxuPG5nLXRlbXBsYXRlICNsb29wIGxldC1pdGVtcz1cIml0ZW1zXCIgbGV0LWlkUHJlZml4PVwiaWRQcmVmaXhcIj5cclxuICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBpdGVtIG9mIGl0ZW1zOyBpbmRleCBhcyBpXCI+XHJcbiAgICA8bGkgKm5nSWY9XCIhaXRlbS5oaWRkZW5cIj5cclxuICAgICAgPG5nLWNvbnRhaW5lclxyXG4gICAgICAgICpuZ1RlbXBsYXRlT3V0bGV0PVwiaXRlbS5jaGlsZHJlbj8ubGVuZ3RoID8gZ3JvdXBWaWV3IDogY2hlY2tib3hWaWV3OyBjb250ZXh0OiB7aXRlbTogaXRlbSwgaWRQcmVmaXg6ICcnK2lkUHJlZml4K2l9XCJcclxuICAgICAgPjwvbmctY29udGFpbmVyPlxyXG4gICAgPC9saT5cclxuICA8L25nLWNvbnRhaW5lcj5cclxuPC9uZy10ZW1wbGF0ZT5cclxuXHJcbjxuZy10ZW1wbGF0ZSAjZ3JvdXBWaWV3IGxldC1ncm91cD1cIml0ZW1cIiBsZXQtaWRQcmVmaXg9XCJpZFByZWZpeFwiPlxyXG4gIDxkaXYgY2xhc3M9XCJzMi11aS1pbmxpbmUtaW5wdXQtbGFiZWxcIj5cclxuICAgIDxkaXYgY2xhc3M9XCJzMi1jaGVja2JveC10cmVlLWl0ZW1fX2J1dHRvbi1wbGFjZWhvbGRlclwiPlxyXG4gICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cInMyLWNoZWNrYm94LXRyZWUtaXRlbV9fY2hldnJvbi1idXR0b25cIiAoY2xpY2spPVwiZ3JvdXAub3BlbiA9ICFncm91cC5vcGVuXCI+XHJcbiAgICAgICAgPHMyLWljb24+e3sgZ3JvdXAub3BlbiA/ICdleHBhbmRfbW9yZScgOiAnY2hldnJvbl9yaWdodCd9fSA8L3MyLWljb24+XHJcbiAgICAgIDwvYnV0dG9uPlxyXG4gICAgPC9kaXY+XHJcbiAgICA8aW5wdXRcclxuICAgICAgdHlwZT1cImNoZWNrYm94XCJcclxuICAgICAgW2lkXT1cImlkUHJlZml4ICsgJy0nICsgKGdyb3VwLmtleSAhPT0gdW5kZWZpbmVkID8gZ3JvdXAua2V5IDogZ3JvdXAubGFiZWwpXCJcclxuICAgICAgY2xhc3M9XCJzMi11aS1pbnB1dC1jaGVja2JveFwiXHJcbiAgICAgIFtjaGVja2VkXT1cImdyb3VwLmNoZWNrZWRcIlxyXG4gICAgICBbZGlzYWJsZWRdPVwiZGlzYWJsZWQgfHwgZ3JvdXAuZGlzYWJsZWRcIlxyXG4gICAgICBbbmdDbGFzc109XCJ7J3MyLXVpLWlucHV0LWNoZWNrYm94LS1zZW1pLXNlbGVjdGVkJzogZ3JvdXAuY2hlY2tlZCA9PT0gJ3NlbWknfVwiXHJcbiAgICAgIChjaGFuZ2UpPVwiaGFuZGxlQ2hlY2tib3hDaGFuZ2UoZ3JvdXAsICRldmVudClcIlxyXG4gICAgLz5cclxuICAgIDxsYWJlbFxyXG4gICAgICBjbGFzcz1cInMyLWNoZWNrYm94LXRyZWUtaXRlbV9fbGFiZWxcIlxyXG4gICAgICBbZm9yXT1cImlkUHJlZml4ICsgJy0nICsgKGdyb3VwLmtleSAhPT0gdW5kZWZpbmVkID8gZ3JvdXAua2V5IDogZ3JvdXAubGFiZWwpXCJcclxuICAgID5cclxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIml0ZW1MYWJlbFRlbXBsYXRlXCI+XHJcbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cIml0ZW1MYWJlbFRlbXBsYXRlOyBjb250ZXh0OiB7JGltcGxpY2l0OiBncm91cH1cIj48L25nLWNvbnRhaW5lcj5cclxuICAgICAgPC9uZy1jb250YWluZXI+XHJcbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhaXRlbUxhYmVsVGVtcGxhdGVcIj5cclxuICAgICAgICB7eyBncm91cC5sYWJlbCB9fVxyXG4gICAgICA8L25nLWNvbnRhaW5lcj5cclxuICAgIDwvbGFiZWw+XHJcbiAgPC9kaXY+XHJcbiAgPHVsICpuZ0lmPVwiZ3JvdXAub3BlblwiPlxyXG4gICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImxvb3A7IGNvbnRleHQ6IHtpdGVtczogZ3JvdXAuY2hpbGRyZW4sIGlkUHJlZml4OiBpZFByZWZpeH1cIj48L25nLWNvbnRhaW5lcj5cclxuICA8L3VsPlxyXG48L25nLXRlbXBsYXRlPlxyXG5cclxuPG5nLXRlbXBsYXRlICNjaGVja2JveFZpZXcgbGV0LWNoZWNrYm94PVwiaXRlbVwiIGxldC1pZFByZWZpeD1cImlkUHJlZml4XCI+XHJcbiAgPGRpdiBjbGFzcz1cInMyLXVpLWlubGluZS1pbnB1dC1sYWJlbFwiPlxyXG4gICAgPGRpdiBjbGFzcz1cInMyLWNoZWNrYm94LXRyZWUtaXRlbV9fYnV0dG9uLXBsYWNlaG9sZGVyXCI+PC9kaXY+XHJcbiAgICA8aW5wdXRcclxuICAgICAgdHlwZT1cImNoZWNrYm94XCJcclxuICAgICAgW2lkXT1cImlkUHJlZml4ICsgJy0nICsgKGNoZWNrYm94LmtleSAhPT0gdW5kZWZpbmVkID8gY2hlY2tib3gua2V5IDogY2hlY2tib3gubGFiZWwpXCJcclxuICAgICAgY2xhc3M9XCJzMi11aS1pbnB1dC1jaGVja2JveFwiXHJcbiAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZCB8fCBjaGVja2JveC5kaXNhYmxlZFwiXHJcbiAgICAgIFsobmdNb2RlbCldPVwiY2hlY2tib3guY2hlY2tlZFwiXHJcbiAgICAgIChuZ01vZGVsQ2hhbmdlKT1cImhhbmRsZUNoZWNrYm94Q2hhbmdlKGNoZWNrYm94LCBudWxsKVwiXHJcbiAgICAvPlxyXG4gICAgPGxhYmVsXHJcbiAgICAgIGNsYXNzPVwiczItY2hlY2tib3gtdHJlZS1pdGVtX19sYWJlbFwiXHJcbiAgICAgIFtmb3JdPVwiaWRQcmVmaXggKyAnLScgKyAoY2hlY2tib3gua2V5ICE9PSB1bmRlZmluZWQgPyBjaGVja2JveC5rZXkgOiBjaGVja2JveC5sYWJlbClcIlxyXG4gICAgPlxyXG4gICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiaXRlbUxhYmVsVGVtcGxhdGVcIj5cclxuICAgICAgICA8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwiaXRlbUxhYmVsVGVtcGxhdGU7IGNvbnRleHQ6IHskaW1wbGljaXQ6IGNoZWNrYm94fVwiPjwvbmctY29udGFpbmVyPlxyXG4gICAgICA8L25nLWNvbnRhaW5lcj5cclxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFpdGVtTGFiZWxUZW1wbGF0ZVwiPlxyXG4gICAgICAgIHt7IGNoZWNrYm94LmxhYmVsIH19XHJcbiAgICAgIDwvbmctY29udGFpbmVyPlxyXG4gICAgPC9sYWJlbD5cclxuICA8L2Rpdj5cclxuPC9uZy10ZW1wbGF0ZT5cclxuIl19