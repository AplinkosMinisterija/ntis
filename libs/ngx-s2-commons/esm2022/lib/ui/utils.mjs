import { BaseBrowseForm } from '../form/base.browse.form';
export const SPEC_CHARS = '@./$!%*?&#_-';
export const PWD_PATTERN = '(?=^.{12,}$)(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[-@.$/!%*?&#_.])(?!.*\\s).*$';
export function escapeRegExp(str) {
    return str.replace(/[-[\]/{}()*+?.\\^$|]/g, '\\$&');
}
export function toKeyValues(codes) {
    if (Array.isArray(codes)) {
        return codes.map((code) => ({ code }));
    }
    return [];
}
export function fromKeyValues(keyValues) {
    if (Array.isArray(keyValues)) {
        return keyValues.map((keyValue) => keyValue.code);
    }
    return [];
}
export function convertKeyValues(keyValues) {
    if (Array.isArray(keyValues)) {
        return keyValues.map((keyValue) => ({ value: keyValue.code, label: keyValue.key_value }));
    }
    return [];
}
export function keyValuesToMap(keyValues) {
    const result = new Map();
    keyValues.forEach((keyValue) => {
        result.set(keyValue.code, keyValue.key_value);
    });
    return result;
}
const Y = 'Y';
const N = 'N';
export function toBoolean(value) {
    return value === Y;
}
export function fromBoolean(value) {
    return value ? Y : N;
}
export function toRadioBtnIdVal(values) {
    let result = null;
    if (values) {
        const value = values.find((p) => p.key_value === Y);
        if (value) {
            result = value.id;
        }
    }
    return result;
}
export function fromRadioBtnIdVal(array, id) {
    if (array) {
        array.forEach((p) => {
            p.key_value = p.id === id ? Y : N;
        });
    }
    return array;
}
export function toRadioBtnKeyVal(values) {
    let result = '';
    if (values) {
        const value = values.find((p) => p.key_value === Y);
        if (value) {
            result = value.code;
        }
    }
    return result;
}
export function fromRadioBtnKeyVal(array, code) {
    if (array) {
        array.forEach((p) => {
            p.key_value = p.code === code ? Y : N;
        });
    }
    return array;
}
export function appendPagingParams(url, pagingParams) {
    if (!pagingParams) {
        return url;
    }
    if (!pagingParams.page_size) {
        pagingParams.page_size = BaseBrowseForm.DEFAULT_ROWS_TO_SHOW;
    }
    if (url.substring(url.length - 1) !== '?') {
        url = url + '&';
    }
    url = `${url}page_size=${pagingParams.page_size}&skip_rows=${pagingParams.skip_rows}`;
    if (pagingParams.order_clause) {
        url = url + '&order_clause=' + pagingParams.order_clause;
    }
    return url;
}
export function appendSearchParams(url, params) {
    if (params) {
        params.forEach((value, key) => {
            if (value && value !== '') {
                url = `${url}&${key}=${value}`;
            }
        });
    }
    return url;
}
export const deepEquals = (x, y) => {
    if (x === y) {
        return true; // if both x and y are null or undefined and exactly the same
    }
    else if (!(x instanceof Object) || !(y instanceof Object)) {
        return false; // if they are not strictly equal, they both need to be Objects
    }
    else if (x.constructor !== y.constructor) {
        // they must have the exact same prototype chain, the closest we can do is
        // test their constructor.
        return false;
    }
    else {
        for (const p in x) {
            if (!Object.prototype.hasOwnProperty.call(x, p)) {
                continue; // other properties were tested using x.constructor === y.constructor
            }
            if (!Object.prototype.hasOwnProperty.call(y, p)) {
                return false; // allows to compare x[ p ] and y[ p ] when set to undefined
            }
            if (x[p] === y[p]) {
                continue; // if they have the same strict value or identity then they are equal
            }
            if (typeof x[p] !== 'object') {
                return false; // Numbers, Strings, Functions, Booleans must be strictly equal
            }
            if (!deepEquals(x[p], y[p])) {
                return false;
            }
        }
        for (const p in y) {
            if (Object.prototype.hasOwnProperty.call(y, p) && !Object.prototype.hasOwnProperty.call(x, p)) {
                return false;
            }
        }
        return true;
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtczItY29tbW9ucy9zcmMvbGliL3VpL3V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUsxRCxNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsY0FBYyxDQUFDO0FBQ3pDLE1BQU0sQ0FBQyxNQUFNLFdBQVcsR0FBRyw4RUFBOEUsQ0FBQztBQUUxRyxNQUFNLFVBQVUsWUFBWSxDQUFDLEdBQVc7SUFDdEMsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDLHVCQUF1QixFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQ3RELENBQUM7QUFFRCxNQUFNLFVBQVUsV0FBVyxDQUFDLEtBQWU7SUFDekMsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO1FBQ3hCLE9BQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBd0IsQ0FBQSxDQUFDLENBQUM7S0FDN0Q7SUFDRCxPQUFPLEVBQUUsQ0FBQztBQUNaLENBQUM7QUFFRCxNQUFNLFVBQVUsYUFBYSxDQUFDLFNBQThCO0lBQzFELElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRTtRQUM1QixPQUFPLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUNuRDtJQUNELE9BQU8sRUFBRSxDQUFDO0FBQ1osQ0FBQztBQUVELE1BQU0sVUFBVSxnQkFBZ0IsQ0FBQyxTQUE4QjtJQUM3RCxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEVBQUU7UUFDNUIsT0FBTyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FB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RCxPQUFPLElBQUksQ0FBQztLQUNiO0FBQ0gsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzZUJyb3dzZUZvcm0gfSBmcm9tICcuLi9mb3JtL2Jhc2UuYnJvd3NlLmZvcm0nO1xyXG5pbXBvcnQgeyBTcHJfaWRfdmFsdWVzX290IH0gZnJvbSAnLi4vbW9kZWwvc3ByX2lkX3ZhbHVlc19vdCc7XHJcbmltcG9ydCB7IFNwcl9rZXlfdmFsdWVzX290IH0gZnJvbSAnLi4vbW9kZWwvc3ByX2tleV92YWx1ZXNfb3QnO1xyXG5pbXBvcnQgeyBTcHJfcGFnaW5nX290IH0gZnJvbSAnLi4vbW9kZWwvc3ByX3BhZ2luZ19vdCc7XHJcblxyXG5leHBvcnQgY29uc3QgU1BFQ19DSEFSUyA9ICdALi8kISUqPyYjXy0nO1xyXG5leHBvcnQgY29uc3QgUFdEX1BBVFRFUk4gPSAnKD89Xi57MTIsfSQpKD89LipcXFxcZCkoPz0uKlthLXpdKSg/PS4qW0EtWl0pKD89LipbLUAuJC8hJSo/JiNfLl0pKD8hLipcXFxccykuKiQnO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHI6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bLVtcXF0ve30oKSorPy5cXFxcXiR8XS9nLCAnXFxcXCQmJyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0b0tleVZhbHVlcyhjb2Rlczogc3RyaW5nW10pOiBTcHJfa2V5X3ZhbHVlc19vdFtdIHtcclxuICBpZiAoQXJyYXkuaXNBcnJheShjb2RlcykpIHtcclxuICAgIHJldHVybiBjb2Rlcy5tYXAoKGNvZGUpID0+ICh7IGNvZGUgfSBhcyBTcHJfa2V5X3ZhbHVlc19vdCkpO1xyXG4gIH1cclxuICByZXR1cm4gW107XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmcm9tS2V5VmFsdWVzKGtleVZhbHVlczogU3ByX2tleV92YWx1ZXNfb3RbXSk6IHN0cmluZ1tdIHtcclxuICBpZiAoQXJyYXkuaXNBcnJheShrZXlWYWx1ZXMpKSB7XHJcbiAgICByZXR1cm4ga2V5VmFsdWVzLm1hcCgoa2V5VmFsdWUpID0+IGtleVZhbHVlLmNvZGUpO1xyXG4gIH1cclxuICByZXR1cm4gW107XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0S2V5VmFsdWVzKGtleVZhbHVlczogU3ByX2tleV92YWx1ZXNfb3RbXSk6IHsgdmFsdWU6IHN0cmluZzsgbGFiZWw6IHN0cmluZyB9W10ge1xyXG4gIGlmIChBcnJheS5pc0FycmF5KGtleVZhbHVlcykpIHtcclxuICAgIHJldHVybiBrZXlWYWx1ZXMubWFwKChrZXlWYWx1ZSkgPT4gKHsgdmFsdWU6IGtleVZhbHVlLmNvZGUsIGxhYmVsOiBrZXlWYWx1ZS5rZXlfdmFsdWUgfSkpO1xyXG4gIH1cclxuICByZXR1cm4gW107XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBrZXlWYWx1ZXNUb01hcChrZXlWYWx1ZXM6IFNwcl9rZXlfdmFsdWVzX290W10pOiBNYXA8c3RyaW5nLCBzdHJpbmc+IHtcclxuICBjb25zdCByZXN1bHQgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpO1xyXG4gIGtleVZhbHVlcy5mb3JFYWNoKChrZXlWYWx1ZSkgPT4ge1xyXG4gICAgcmVzdWx0LnNldChrZXlWYWx1ZS5jb2RlLCBrZXlWYWx1ZS5rZXlfdmFsdWUpO1xyXG4gIH0pO1xyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmNvbnN0IFkgPSAnWSc7XHJcbmNvbnN0IE4gPSAnTic7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9Cb29sZWFuKHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICByZXR1cm4gdmFsdWUgPT09IFk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmcm9tQm9vbGVhbih2YWx1ZTogYm9vbGVhbik6IHN0cmluZyB7XHJcbiAgcmV0dXJuIHZhbHVlID8gWSA6IE47XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0b1JhZGlvQnRuSWRWYWwodmFsdWVzOiBTcHJfaWRfdmFsdWVzX290W10pOiBudW1iZXIge1xyXG4gIGxldCByZXN1bHQ6IG51bWJlciA9IG51bGw7XHJcbiAgaWYgKHZhbHVlcykge1xyXG4gICAgY29uc3QgdmFsdWU6IFNwcl9pZF92YWx1ZXNfb3QgPSB2YWx1ZXMuZmluZCgocCkgPT4gcC5rZXlfdmFsdWUgPT09IFkpO1xyXG4gICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgIHJlc3VsdCA9IHZhbHVlLmlkO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZnJvbVJhZGlvQnRuSWRWYWwoYXJyYXk6IFNwcl9pZF92YWx1ZXNfb3RbXSwgaWQ6IG51bWJlcik6IFNwcl9pZF92YWx1ZXNfb3RbXSB7XHJcbiAgaWYgKGFycmF5KSB7XHJcbiAgICBhcnJheS5mb3JFYWNoKChwKSA9PiB7XHJcbiAgICAgIHAua2V5X3ZhbHVlID0gcC5pZCA9PT0gaWQgPyBZIDogTjtcclxuICAgIH0pO1xyXG4gIH1cclxuICByZXR1cm4gYXJyYXk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0b1JhZGlvQnRuS2V5VmFsKHZhbHVlczogU3ByX2tleV92YWx1ZXNfb3RbXSk6IHN0cmluZyB7XHJcbiAgbGV0IHJlc3VsdCA9ICcnO1xyXG4gIGlmICh2YWx1ZXMpIHtcclxuICAgIGNvbnN0IHZhbHVlOiBTcHJfa2V5X3ZhbHVlc19vdCA9IHZhbHVlcy5maW5kKChwKSA9PiBwLmtleV92YWx1ZSA9PT0gWSk7XHJcbiAgICBpZiAodmFsdWUpIHtcclxuICAgICAgcmVzdWx0ID0gdmFsdWUuY29kZTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZyb21SYWRpb0J0bktleVZhbChhcnJheTogU3ByX2tleV92YWx1ZXNfb3RbXSwgY29kZTogc3RyaW5nKTogU3ByX2tleV92YWx1ZXNfb3RbXSB7XHJcbiAgaWYgKGFycmF5KSB7XHJcbiAgICBhcnJheS5mb3JFYWNoKChwKSA9PiB7XHJcbiAgICAgIHAua2V5X3ZhbHVlID0gcC5jb2RlID09PSBjb2RlID8gWSA6IE47XHJcbiAgICB9KTtcclxuICB9XHJcbiAgcmV0dXJuIGFycmF5O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYXBwZW5kUGFnaW5nUGFyYW1zKHVybDogc3RyaW5nLCBwYWdpbmdQYXJhbXM6IFNwcl9wYWdpbmdfb3QpOiBzdHJpbmcge1xyXG4gIGlmICghcGFnaW5nUGFyYW1zKSB7XHJcbiAgICByZXR1cm4gdXJsO1xyXG4gIH1cclxuICBpZiAoIXBhZ2luZ1BhcmFtcy5wYWdlX3NpemUpIHtcclxuICAgIHBhZ2luZ1BhcmFtcy5wYWdlX3NpemUgPSBCYXNlQnJvd3NlRm9ybS5ERUZBVUxUX1JPV1NfVE9fU0hPVztcclxuICB9XHJcbiAgaWYgKHVybC5zdWJzdHJpbmcodXJsLmxlbmd0aCAtIDEpICE9PSAnPycpIHtcclxuICAgIHVybCA9IHVybCArICcmJztcclxuICB9XHJcbiAgdXJsID0gYCR7dXJsfXBhZ2Vfc2l6ZT0ke3BhZ2luZ1BhcmFtcy5wYWdlX3NpemV9JnNraXBfcm93cz0ke3BhZ2luZ1BhcmFtcy5za2lwX3Jvd3N9YDtcclxuICBpZiAocGFnaW5nUGFyYW1zLm9yZGVyX2NsYXVzZSkge1xyXG4gICAgdXJsID0gdXJsICsgJyZvcmRlcl9jbGF1c2U9JyArIHBhZ2luZ1BhcmFtcy5vcmRlcl9jbGF1c2U7XHJcbiAgfVxyXG4gIHJldHVybiB1cmw7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhcHBlbmRTZWFyY2hQYXJhbXModXJsOiBzdHJpbmcsIHBhcmFtczogTWFwPHN0cmluZywgdW5rbm93bj4pOiBzdHJpbmcge1xyXG4gIGlmIChwYXJhbXMpIHtcclxuICAgIHBhcmFtcy5mb3JFYWNoKCh2YWx1ZTogdW5rbm93biwga2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgaWYgKHZhbHVlICYmIHZhbHVlICE9PSAnJykge1xyXG4gICAgICAgIHVybCA9IGAke3VybH0mJHtrZXl9PSR7dmFsdWUgYXMgc3RyaW5nfWA7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICByZXR1cm4gdXJsO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgZGVlcEVxdWFscyA9ICh4OiB1bmtub3duLCB5OiB1bmtub3duKTogYm9vbGVhbiA9PiB7XHJcbiAgaWYgKHggPT09IHkpIHtcclxuICAgIHJldHVybiB0cnVlOyAvLyBpZiBib3RoIHggYW5kIHkgYXJlIG51bGwgb3IgdW5kZWZpbmVkIGFuZCBleGFjdGx5IHRoZSBzYW1lXHJcbiAgfSBlbHNlIGlmICghKHggaW5zdGFuY2VvZiBPYmplY3QpIHx8ICEoeSBpbnN0YW5jZW9mIE9iamVjdCkpIHtcclxuICAgIHJldHVybiBmYWxzZTsgLy8gaWYgdGhleSBhcmUgbm90IHN0cmljdGx5IGVxdWFsLCB0aGV5IGJvdGggbmVlZCB0byBiZSBPYmplY3RzXHJcbiAgfSBlbHNlIGlmICh4LmNvbnN0cnVjdG9yICE9PSB5LmNvbnN0cnVjdG9yKSB7XHJcbiAgICAvLyB0aGV5IG11c3QgaGF2ZSB0aGUgZXhhY3Qgc2FtZSBwcm90b3R5cGUgY2hhaW4sIHRoZSBjbG9zZXN0IHdlIGNhbiBkbyBpc1xyXG4gICAgLy8gdGVzdCB0aGVpciBjb25zdHJ1Y3Rvci5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9IGVsc2Uge1xyXG4gICAgZm9yIChjb25zdCBwIGluIHgpIHtcclxuICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgcCkpIHtcclxuICAgICAgICBjb250aW51ZTsgLy8gb3RoZXIgcHJvcGVydGllcyB3ZXJlIHRlc3RlZCB1c2luZyB4LmNvbnN0cnVjdG9yID09PSB5LmNvbnN0cnVjdG9yXHJcbiAgICAgIH1cclxuICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeSwgcCkpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7IC8vIGFsbG93cyB0byBjb21wYXJlIHhbIHAgXSBhbmQgeVsgcCBdIHdoZW4gc2V0IHRvIHVuZGVmaW5lZFxyXG4gICAgICB9XHJcbiAgICAgIGlmICgoeCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPilbcF0gPT09ICh5IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KVtwXSkge1xyXG4gICAgICAgIGNvbnRpbnVlOyAvLyBpZiB0aGV5IGhhdmUgdGhlIHNhbWUgc3RyaWN0IHZhbHVlIG9yIGlkZW50aXR5IHRoZW4gdGhleSBhcmUgZXF1YWxcclxuICAgICAgfVxyXG4gICAgICBpZiAodHlwZW9mICh4IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KVtwXSAhPT0gJ29iamVjdCcpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7IC8vIE51bWJlcnMsIFN0cmluZ3MsIEZ1bmN0aW9ucywgQm9vbGVhbnMgbXVzdCBiZSBzdHJpY3RseSBlcXVhbFxyXG4gICAgICB9XHJcbiAgICAgIGlmICghZGVlcEVxdWFscygoeCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPilbcF0sICh5IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KVtwXSkpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGZvciAoY29uc3QgcCBpbiB5KSB7XHJcbiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeSwgcCkgJiYgIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCBwKSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG59O1xyXG4iXX0=